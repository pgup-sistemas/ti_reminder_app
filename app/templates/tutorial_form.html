{% extends 'base.html' %}
{% block title %}{{ title }} | TI OSN System{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/tutorial-form.js') }}"></script>
{% endblock %}

{% block content %}
<!-- Região de anúncio para leitores de tela -->
<div id="a11y-live-region" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>

<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header bg-body-tertiary text-black d-flex align-items-center">
          <i class="fas fa-tools me-2" aria-hidden="true"></i>
          <h1 class="h4 mb-0">{{ title }}</h1>
        </div>
        <div class="card-body">
          <form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate aria-labelledby="tutorial-form-title">
            <p class="visually-hidden" id="tutorial-form-title">Formulário de {{ title }}</p>
            {{ form.hidden_tag() }}
            <!-- Título -->
            <div class="mb-4 field-group required">
              {{ form.titulo.label(class="form-label fw-semibold") }}
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-heading" aria-hidden="true"></i></span>
                {{ form.titulo(class="form-control" + (' is-invalid' if form.titulo.errors else ''), 
                              placeholder="Digite um título descritivo para o tutorial") }}
              </div>
              <div class="form-text">Título claro e objetivo que descreva o conteúdo do tutorial</div>
              {% for error in form.titulo.errors %}
                <div class="invalid-feedback d-block" role="alert">
                  <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                </div>
              {% endfor %}
            </div>
            <!-- Categoria -->
            <div class="mb-4 field-group required">
              {{ form.categoria.label(class="form-label fw-semibold") }}
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-tags" aria-hidden="true"></i></span>
                {{ form.categoria(class="form-select" + (' is-invalid' if form.categoria.errors else ''), 
                                **{'aria-describedby': 'categoriaHelp'}) }}
              </div>
              <div id="categoriaHelp" class="form-text">Selecione a categoria mais adequada para este tutorial</div>
              {% for error in form.categoria.errors %}
                <div class="invalid-feedback d-block" role="alert">
                  <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                </div>
              {% endfor %}
            </div>
            <!-- Conteúdo -->
            <div class="mb-4 field-group required">
              {{ form.conteudo.label(class="form-label fw-semibold") }}
              {{ form.conteudo(class="form-control" + (' is-invalid' if form.conteudo.errors else ''), 
                            rows=8, placeholder="Descreva o passo a passo do tutorial de forma clara e detalhada") }}
              <div class="form-text">
                <p class="mb-1">Dicas para um bom tutorial:</p>
                <ul class="small">
                  <li>Seja claro e objetivo</li>
                  <li>Use marcadores ou numeração para passos sequenciais</li>
                  <li>Destaque informações importantes em <strong>negrito</strong></li>
                </ul>
              </div>
              {% for error in form.conteudo.errors %}
                <div class="invalid-feedback d-block" role="alert">
                  <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                </div>
              {% endfor %}
            </div>
            <!-- Upload de Imagens -->
            <div class="mb-4 field-group">
              {{ form.imagem.label(class="form-label fw-semibold") }}
              <div class="file-upload-wrapper" data-text="Selecionar arquivos...">
                {{ form.imagem(class="form-control" + (' is-invalid' if form.imagem.errors else ''), 
                              **{'aria-describedby': 'imagemHelp', 'data-browse': 'Procurar'}) }}
              </div>
              <div id="imagemHelp" class="form-text">
                <p class="mb-1">Formatos aceitos: JPG, PNG, GIF (máx. 5MB por arquivo)</p>
                <p class="mb-0">Você pode selecionar múltiplos arquivos mantendo a tecla Ctrl pressionada.</p>
              </div>
              {% for error in form.imagem.errors %}
                <div class="invalid-feedback d-block" role="alert">
                  <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                </div>
              {% endfor %}
            </div>
            <!-- Dicas de acessibilidade para teclado -->
            <div class="alert alert-info mt-4 mb-0" role="alert">
                <div class="d-flex align-items-center">
                    <i class="fas fa-keyboard me-2" aria-hidden="true"></i>
                    <div>
                        <p class="mb-1 fw-bold">Dicas de teclado:</p>
                        <ul class="mb-0">
                            <li>Pressione <kbd>Tab</kbd> para navegar entre os campos</li>
                            <li>Use <kbd>Enter</kbd> para ir para o próximo campo</li>
                            <li><kbd>Ctrl</kbd> + <kbd>Enter</kbd> para enviar o formulário</li>
                            <li><kbd>Esc</kbd> para limpar o campo atual</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-between mt-4">
              <a href="{{ url_for('main.listar_tutoriais') }}" class="btn btn-outline-secondary" aria-label="Cancelar e voltar para a lista de tutoriais">
                <i class="fas fa-times me-1" aria-hidden="true"></i>Cancelar
              </a>
              <button type="submit" class="btn btn-success" aria-label="Salvar tutorial">
                <i class="fas fa-save me-1" aria-hidden="true"></i>Salvar Tutorial
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}