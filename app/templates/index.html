
{% extends "base.html" %}
{% block title %}Dashboard | TI OSN System{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 fw-bold mb-1 text-primary">
                    <i class="fas fa-tachometer-alt me-2"></i>Dashboard de A√ß√µes R√°pidas
                </h1>
                <p class="text-muted mb-0">Bem-vindo de volta, {{ session['username'] }}! Acompanhe as principais informa√ß√µes do sistema.</p>
            </div>            
        </div>
    </div>
</div>
<!-- Cards de resumo -->
<div class="row g-4 mb-5">
    <!-- Card de Lembretes -->
    <div class="col-xl-3 col-md-6">
        <div class="sla-card primary h-100 animate-on-scroll">
            <div class="sla-value">{{ lembretes_count or 0 }}</div>
            <div class="sla-label">Lembretes Ativos</div>
            <div class="sla-description">Pr√≥ximos vencimentos</div>
            <div class="d-flex justify-content-center mt-3">
                <i class="fas fa-bell fa-2x text-primary"></i>
            </div>
        </div>
    </div>
    
    <!-- Card de Tarefas -->
    <div class="col-xl-3 col-md-6">
        <div class="sla-card success h-100 animate-on-scroll">
            <div class="sla-value">{{ tarefas_count or 0 }}</div>
            <div class="sla-label">Tarefas Pendentes</div>
            <div class="sla-description">Para hoje</div>
            <div class="d-flex justify-content-center mt-3">
                <i class="fas fa-tasks fa-2x text-success"></i>
            </div>
        </div>
    </div>
    
    <!-- Card de Chamados -->
    <div class="col-xl-3 col-md-6">
        <div class="sla-card warning h-100 animate-on-scroll">
            <div class="sla-value">{{ chamados_count or 0 }}</div>
            <div class="sla-label">Chamados Abertos</div>
            <div class="sla-description">Aguardando solu√ß√£o</div>
            <div class="d-flex justify-content-center mt-3">
                <i class="fas fa-ticket-alt fa-2x text-warning"></i>
            </div>
        </div>
    </div>
    
    <!-- Card de Equipamentos -->
    <div class="col-xl-3 col-md-6">
        <div class="sla-card info h-100 animate-on-scroll">
            <div class="sla-value">{{ equipamentos_count or 0 }}</div>
            <div class="sla-label">Qtd.Equipamentos</div>
            <div class="sla-description">Solicitados</div>
            <div class="d-flex justify-content-center mt-3">
                <i class="fas fa-laptop fa-2x text-info"></i>
            </div>
        </div>
    </div>
</div>

<!-- Cards de SLA -->
{% if session.get('is_admin') %}
<div class="row g-4 mb-5">
    <div class="col-12">
        <h2 class="h4 fw-bold text-secondary mb-4">
            <i class="fas fa-clock me-2"></i>Monitoramento de SLA
        </h2>
    </div>
    
    <!-- Card SLA Vencido -->
    <div class="col-lg-3 col-md-6">
        <div class="sla-card danger h-100 animate-on-scroll">
            <div class="sla-value">{{ sla_vencidos or 0 }}</div>
            <div class="sla-label">SLA Vencido</div>
            <div class="sla-description">Chamados fora do prazo</div>
            <div class="d-flex justify-content-center mt-3">
                <i class="fas fa-exclamation-circle fa-2x text-danger"></i>
            </div>
        </div>
    </div>
    
    <!-- Card SLA Cr√≠tico -->
    <div class="col-lg-3 col-md-6">
        <div class="sla-card warning h-100 animate-on-scroll">
            <div class="sla-value">{{ sla_criticos or 0 }}</div>
            <div class="sla-label">SLA Cr√≠tico</div>
            <div class="sla-description">Pr√≥ximos ao vencimento</div>
            <div class="d-flex justify-content-center mt-3">
                <i class="fas fa-clock fa-2x text-warning"></i>
            </div>
        </div>
    </div>
    
    <!-- Card SLA OK -->
    <div class="col-lg-3 col-md-6">
        <div class="sla-card success h-100 animate-on-scroll">
            <div class="sla-value">{{ sla_ok or 0 }}</div>
            <div class="sla-label">SLA OK</div>
            <div class="sla-description">Dentro do prazo</div>
            <div class="d-flex justify-content-center mt-3">
                <i class="fas fa-check-circle fa-2x text-success"></i>
            </div>
        </div>
    </div>
    
    <!-- Card Performance SLA -->
    <div class="col-lg-3 col-md-6">
        <div class="performance-card h-100 animate-on-scroll">
            <h3>Performance SLA</h3>
            <div class="performance-value">{{ performance_sla or 0 }}%</div>
            <div class="performance-label">Taxa de atendimento</div>
            <div class="performance-description">Nos √∫ltimos 30 dias</div>
            <div class="d-flex justify-content-center mt-3">
                <i class="fas fa-chart-line fa-2x text-white-50"></i>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Alertas de SLA -->
{% if session.get('is_admin') and (sla_vencidos > 0 or sla_criticos > 0) %}
<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-{{ 'danger' if sla_vencidos > 0 else 'warning' }} alert-dismissible fade show" role="alert">
            <div class="d-flex align-items-center">
                <i class="fas fa-{{ 'exclamation-triangle' if sla_vencidos > 0 else 'clock' }} fa-2x me-3"></i>
                <div class="flex-grow-1">
                    <h5 class="alert-heading mb-1">
                        {% if sla_vencidos > 0 %}
                            ‚ö†Ô∏è Aten√ß√£o: SLA Vencido!
                        {% else %}
                            üïê Alerta: SLA Pr√≥ximo ao Vencimento
                        {% endif %}
                    </h5>
                    <p class="mb-1">
                        {% if sla_vencidos > 0 %}
                            Existem {{ sla_vencidos }} chamado(s) com SLA vencido que precisam de aten√ß√£o imediata.
                        {% endif %}
                        {% if sla_criticos > 0 %}
                            {% if sla_vencidos > 0 %}Al√©m disso, h√°{% else %}H√°{% endif %} {{ sla_criticos }} chamado(s) com SLA cr√≠tico (pr√≥ximo ao vencimento).
                        {% endif %}
                    </p>
                    <a href="{{ url_for('main.listar_chamados') }}" class="btn btn-{{ 'light' if sla_vencidos > 0 else 'dark' }} btn-sm">
                        <i class="fas fa-list"></i> Ver Chamados
                    </a>
                </div>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>
</div>
{% endif %}

<div class="container-fluid py-4 mb-5 page-transition">
<!-- A√ß√µes r√°pidas -->
<div class="row g-4 mb-5">
    <div class="col-12">
        <h2 class="h4 fw-bold text-secondary mb-4">
            <i class="fas fa-rocket me-2"></i>A√ß√µes R√°pidas
        </h2>
    </div>
    
    <div class="col-xl-2 col-md-4 col-sm-6">
        <a href="{{ url_for('main.reminders') }}" class="text-decoration-none">
            <div class="sla-card primary h-100 animate-on-scroll action-hover compact">
                <div class="d-flex justify-content-center mb-2">
                    <i class="fas fa-bell fa-lg text-primary"></i>
                </div>
                <div class="sla-value-compact">Lembrete</div>
            </div>
        </a>
    </div>
    
    <div class="col-xl-2 col-md-4 col-sm-6">
        <a href="{{ url_for('main.tasks') }}" class="text-decoration-none">
            <div class="sla-card success h-100 animate-on-scroll action-hover compact">
                <div class="d-flex justify-content-center mb-2">
                    <i class="fas fa-tasks fa-lg text-success"></i>
                </div>
                <div class="sla-value-compact">Tarefa</div>
            </div>
        </a>
    </div>
    
    <div class="col-xl-2 col-md-4 col-sm-6">
        <a href="{{ url_for('main.abrir_chamado') }}" class="text-decoration-none">
            <div class="sla-card warning h-100 animate-on-scroll action-hover compact">
                <div class="d-flex justify-content-center mb-2">
                    <i class="fas fa-plus-circle fa-lg text-warning"></i>
                </div>
                <div class="sla-value-compact">Chamado</div>
            </div>
        </a>
    </div>
    
    <div class="col-xl-2 col-md-4 col-sm-6">
        <a href="{{ url_for('main.list_equipment') }}" class="text-decoration-none">
            <div class="sla-card info h-100 animate-on-scroll action-hover compact">
                <div class="d-flex justify-content-center mb-2">
                    <i class="fas fa-laptop fa-lg text-info"></i>
                </div>
                <div class="sla-value-compact">Equipamento</div>
            </div>
        </a>
    </div>
   
    <div class="col-xl-2 col-md-4 col-sm-6">
        <a href="{{ url_for('main.listar_tutoriais') }}" class="text-decoration-none">
            <div class="sla-card secondary h-100 animate-on-scroll action-hover compact">
                <div class="d-flex justify-content-center mb-2">
                    <i class="fas fa-book fa-lg text-secondary"></i>
                </div>
                <div class="sla-value-compact">Tutoriais</div>
            </div>
        </a>
    </div>
    
    <div class="col-xl-2 col-md-4 col-sm-6">
        <a href="{{ url_for('main.user_profile') }}" class="text-decoration-none">
            <div class="sla-card dark h-100 animate-on-scroll action-hover compact">
                <div class="d-flex justify-content-center mb-2">
                    <i class="fas fa-cog fa-lg text-dark"></i>
                </div>
                <div class="sla-value-compact">Configura√ß√µes</div>
            </div>
        </a>
    </div>
</div>

<!-- Atividades recentes -->
<div class="row">
    <div class="col-lg-8">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-transparent border-0 pb-0 pt-3 d-flex justify-content-between align-items-center">
                <h2 class="h5 mb-0 text-secondary">
                    <i class="fas fa-stream me-2 text-primary"></i>
                    Atividades Recentes
                </h2>
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="activityFilter" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-filter me-1"></i> Filtrar
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="activityFilter">
                        <li><a class="dropdown-item active" href="#">Todas as atividades</a></li>
                        <li><a class="dropdown-item" href="#">Minhas atividades</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#">Chamados</a></li>
                        <li><a class="dropdown-item" href="#">Lembretes</a></li>
                        <li><a class="dropdown-item" href="#">Sistema</a></li>
                    </ul>
                </div>
            </div>
            <div class="card-body pt-3">
                {% if atividades_recentes %}
                <div class="timeline">
                    {% for atividade in atividades_recentes %}
                    <div class="timeline-card mb-3 p-3 rounded-3 border-0 shadow-sm bg-white">
                        <div class="d-flex">
                            <div class="timeline-badge bg-{{ atividade.cor }}-light text-{{ atividade.cor }} d-flex align-items-center justify-content-center rounded-circle me-3" style="width: 40px; height: 40px;">
                                <i class="fas fa-{{ atividade.icone }} fa-fw"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <h6 class="mb-0 fw-semibold">{{ atividade.titulo }}</h6>
                                    <span class="badge bg-{{ atividade.cor }}-light text-{{ atividade.cor }} rounded-pill">{{ atividade.status }}</span>
                                </div>
                                <p class="text-muted small mb-1">{{ atividade.tipo|capitalize }}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted"><i class="far fa-clock me-1"></i> {{ atividade.data|local_date }}</small>
                                    {% if atividade.tipo == 'tarefa' %}
                                        <a href="{{ url_for('main.tasks') }}" class="text-primary small">Detalhes <i class="fas fa-chevron-right ms-1"></i></a>
                                    {% elif atividade.tipo == 'lembrete' %}
                                        <a href="{{ url_for('main.reminders') }}" class="text-primary small">Detalhes <i class="fas fa-chevron-right ms-1"></i></a>
                                    {% elif atividade.tipo == 'chamado' %}
                                        <a href="{{ url_for('main.listar_chamados') }}" class="text-primary small">Detalhes <i class="fas fa-chevron-right ms-1"></i></a>
                                    {% elif atividade.tipo == 'equipamento' %}
                                        <a href="{{ url_for('main.list_equipment') }}" class="text-primary small">Detalhes <i class="fas fa-chevron-right ms-1"></i></a>
                                    {% else %}
                                        <a href="{{ url_for('main.dashboard') }}" class="text-primary small">Detalhes <i class="fas fa-chevron-right ms-1"></i></a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="text-center mt-4">
                    <a href="{{ url_for('main.listar_chamados') }}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-list-ul me-1"></i> Ver todas as atividades
                    </a>
                </div>
                {% else %}
                <div class="d-flex flex-column align-items-center justify-content-center text-center p-5 bg-light rounded-3">
                    <div class="bg-primary bg-opacity-10 text-primary rounded-circle p-4 mb-3">
                        <i class="fas fa-history fa-2x"></i>
                    </div>
                    <h6 class="mb-3">Nenhuma atividade recente</h6>
                    <p class="text-muted small mb-3">As atividades aparecer√£o aqui conforme voc√™ usar o sistema.</p>
                    <a href="#" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-plus me-1"></i> Criar nova atividade
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card shadow-sm border-0 animate-on-scroll h-100">
            <div class="card-header bg-transparent border-0 pb-0 pt-3">
                <h2 class="h5 mb-0 text-secondary">
                    <i class="fas fa-info-circle me-2 text-primary"></i>
                    Sistema
                </h2>
            </div>
            <div class="card-body">
                <div class="system-status-card p-3 mb-4 rounded-3">
                    <div class="d-flex align-items-center">
                        <div class="card-icon me-3">
                            <i class="fas fa-server"></i>
                        </div>
                        <div>
                            <h6 class="mb-0 fw-semibold">Status do Sistema</h6>
                            <span class="badge bg-success bg-opacity-10 text-success">
                                <i class="fas fa-circle me-1"></i> Online
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="system-info-item">
                    <div class="icon bg-primary">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="info-text">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-medium">Usu√°rios Conectados</span>
                            <span class="badge bg-primary bg-opacity-10 text-primary">{{ usuarios_ativos or 0 }} ativos</span>
                        </div>
                        <small>√öltima atualiza√ß√£o: Agora</small>
                        <small class="text-muted">{{ session['username'] }} (voc√™)</small>
                    </div>
                </div>
                
                <div class="system-info-item">
                    <div class="icon bg-info">
                        <i class="far fa-calendar-alt"></i>
                    </div>
                    <div class="info-text">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-medium">√öltimo Acesso</span>
                            <span class="badge bg-info bg-opacity-10 text-info">Hoje</span>
                        </div>
                        <small>{{ ultimo_acesso }}</small>
                    </div>
                </div>
                
                <div class="system-info-item">
                    <div class="icon bg-warning">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="info-text">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-medium">Armazenamento</span>
                            <span class="badge bg-warning bg-opacity-10 text-warning">{{ storage_percent }}% usado</span>
                        </div>
                        <div class="progress mt-2" style="height: 6px;">
                            <div class="progress-bar bg-warning" role="progressbar" style="width: {{ storage_percent }}%" aria-valuenow="{{ storage_percent }}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <small class="d-flex justify-content-between mt-1">
                            <span>{{ "%.1f"|format(storage_used_gb) }} GB de {{ "%.1f"|format(storage_total_gb) }} GB</span>
                            <a href="#" class="text-decoration-none">Gerenciar</a>
                        </small>
                    </div>
                </div>
                
                <div class="mt-4 pt-3 border-top">
                    <div class="d-flex justify-content-between align-items-center">
                        <a href="#" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-cog me-1"></i> Configura√ß√µes
                        </a>
                        <div class="text-muted small">
                            v2.4.1 ‚Ä¢ <a href="#" class="text-decoration-none">Ver atualiza√ß√µes</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Estilos compactos para a√ß√µes r√°pidas */
.sla-card.compact {
    padding: 1rem !important;
    min-height: 80px !important;
}

.sla-value-compact {
    font-size: 0.9rem !important;
    font-weight: 600 !important;
    color: #495057 !important;
    text-align: center !important;
    margin: 0 !important;
}

.sla-card.compact .mb-2 {
    margin-bottom: 0.5rem !important;
}

.sla-card.compact i.fa-lg {
    font-size: 1.2rem !important;
}

/* Estilos para a timeline de atividades recentes */
.timeline-container {
    position: relative;
    padding: 0;
    margin: 0;
}

.timeline-item {
    display: flex;
    margin-bottom: 1rem;
    position: relative;
}

.timeline-item:last-child {
    margin-bottom: 0;
}

.timeline-marker {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    color: white;
    margin-right: 15px;
}

.timeline-content {
    flex-grow: 1;
    background-color: rgba(0,0,0,0.03);
    border-radius: 0.5rem;
    padding: 0.75rem;
}

.timeline-content h6 {
    font-weight: 600;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Garante que as anima√ß√µes n√£o afetem a visibilidade
    const cards = document.querySelectorAll('.dashboard-card, .modern-card');
    cards.forEach((card, index) => {
        card.style.opacity = '1';
        card.style.visibility = 'visible';
        card.style.animationDelay = `${index * 0.1}s`;
        if (!card.classList.contains('animate-on-scroll')) {
            card.classList.add('fade-in');
        }
    });
    
    // Configura o Intersection Observer para as anima√ß√µes de scroll
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate-on-scroll-visible');
            }
        });
    }, { threshold: 0.1 });

    // Observa todos os elementos com a classe animate-on-scroll
    document.querySelectorAll('.animate-on-scroll').forEach(el => observer.observe(el));
    
    // Atualiza√ß√£o autom√°tica dos contadores
    setInterval(() => {
        // Aqui voc√™ pode adicionar l√≥gica para atualizar os contadores
        console.log('Atualizando contadores...');
    }, 300000); // 5 minutos
});
</script>
{% endblock %}
