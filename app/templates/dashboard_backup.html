{% extends 'base.html' %}
{% block title %}Dashboard | TI OSN System{% endblock %}

{% block head %}
<!-- Dashboard specific styles -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<!-- Dashboard Chart Data -->
<script>
window.dashboardChartData = {
    evolution: {
        labels: {{ meses_labels|tojson }},
        tarefas: {{ tarefas_por_mes|tojson }},
        lembretes: {{ lembretes_por_mes|tojson }},
        chamados: {{ chamados_por_mes|tojson }}
    },
    sectors: {
        labels: {{ setores_labels|tojson }},
        tarefas: {{ tarefas_por_setor|tojson }},
        lembretes: {{ lembretes_por_setor|tojson }},
        chamados: {{ chamados_por_setor|tojson }}
    }
};
</script>
<div class="container-fluid py-3">

  <!-- Alertas Críticos -->
  {% if session.get('is_admin') and (sla_vencidos > 0 or sla_criticos > 0) %}
  <div class="alert alert-danger border-0 mb-4" role="alert">
    <div class="d-flex align-items-center">
      <i class="fas fa-exclamation-triangle me-2"></i>
      <div class="flex-grow-1">
        <strong>Atenção: Problemas de SLA Detectados!</strong>
        {% if sla_vencidos > 0 %}<strong>{{ sla_vencidos }}</strong> chamado(s) com SLA vencido{% endif %}
        {% if sla_vencidos > 0 and sla_criticos > 0 %} • {% endif %}
        {% if sla_criticos > 0 %}<strong>{{ sla_criticos }}</strong> chamado(s) em situação crítica{% endif %}
      </div>
      <a href="#sla-section" class="btn btn-sm btn-light">Ver Detalhes</a>
    </div>
  </div>
  {% endif %}


  <!-- Header e Filtros -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3">
        <div>
          <h1 class="h3 mb-1">Dashboard</h1>
          <p class="text-muted mb-0">Visão geral do sistema</p>
        </div>
        <div class="d-flex flex-wrap gap-2">
          <!-- Filtros Rápidos -->
          <div class="d-flex flex-wrap gap-1">
            <a href="{{ url_for('main.dashboard', task_status='expired') }}" class="btn btn-outline-danger btn-sm">
              <i class="fas fa-exclamation-circle me-1"></i>Tarefas Vencidas
            </a>
            <a href="{{ url_for('main.dashboard', reminder_status='pending') }}" class="btn btn-outline-warning btn-sm">
              <i class="fas fa-bell me-1"></i>Lembretes Pendentes
            </a>
            <a href="{{ url_for('main.dashboard', chamado_status='Aberto') }}" class="btn btn-outline-info btn-sm">
              <i class="fas fa-ticket-alt me-1"></i>Chamados Abertos
            </a>
          </div>
          
          <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#advancedFilters">
            <i class="fas fa-filter me-1"></i>Filtros Avançados
          </button>
          <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary btn-sm">
            <i class="fas fa-refresh me-1"></i>Limpar
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros Avançados -->
  <div class="collapse mb-4" id="advancedFilters">
    <div class="card">
      <div class="card-body">
        <h6 class="card-title mb-3">Filtros Avançados</h6>
        <form class="row g-3" method="get" action="">
          <!-- Status Filters -->
          <div class="col-12">
            <h6 class="text-muted small mb-2"><i class="fas fa-filter me-1"></i>Status</h6>
          </div>
          <div class="col-lg-2 col-md-4 col-sm-6">
            <label for="task_status" class="form-label small fw-bold">Tarefas</label>
            <select id="task_status" name="task_status" class="form-select form-select-sm">
              <option value="">Todas</option>
              <option value="done" {% if request.args.get('task_status') == 'done' %}selected{% endif %}>Concluídas</option>
              <option value="pending" {% if request.args.get('task_status') == 'pending' %}selected{% endif %}>Pendentes</option>
              <option value="expired" {% if request.args.get('task_status') == 'expired' %}selected{% endif %}>Vencidas</option>
            </select>
          </div>
          <div class="col-lg-2 col-md-4 col-sm-6">
            <label for="reminder_status" class="form-label small fw-bold">Lembretes</label>
            <select id="reminder_status" name="reminder_status" class="form-select form-select-sm">
              <option value="">Todos</option>
              <option value="done" {% if request.args.get('reminder_status') == 'done' %}selected{% endif %}>Realizados</option>
              <option value="pending" {% if request.args.get('reminder_status') == 'pending' %}selected{% endif %}>Pendentes</option>
            </select>
          </div>
          <div class="col-lg-2 col-md-4 col-sm-6">
            <label for="chamado_status" class="form-label small fw-bold">Chamados</label>
            <select id="chamado_status" name="chamado_status" class="form-select form-select-sm">
              <option value="">Todos</option>
              <option value="Aberto" {% if request.args.get('chamado_status') == 'Aberto' %}selected{% endif %}>Aberto</option>
              <option value="Em Andamento" {% if request.args.get('chamado_status') == 'Em Andamento' %}selected{% endif %}>Em Andamento</option>
              <option value="Resolvido" {% if request.args.get('chamado_status') == 'Resolvido' %}selected{% endif %}>Resolvido</option>
              <option value="Fechado" {% if request.args.get('chamado_status') == 'Fechado' %}selected{% endif %}>Fechado</option>
            </select>
          </div>

          <!-- Date Filters -->
          <div class="col-12 mt-3">
            <h6 class="text-muted small mb-2"><i class="fas fa-calendar me-1"></i>Período</h6>
          </div>
          <div class="col-lg-2 col-md-4 col-sm-6">
            <label for="start_date" class="form-label small fw-bold">Data Inicial</label>
            <input type="date" id="start_date" name="start_date" class="form-control form-control-sm" value="{{ request.args.get('start_date', '') }}">
          </div>
          <div class="col-lg-2 col-md-4 col-sm-6">
            <label for="end_date" class="form-label small fw-bold">Data Final</label>
            <input type="date" id="end_date" name="end_date" class="form-control form-control-sm" value="{{ request.args.get('end_date', '') }}">
          </div>

          <!-- Organization Filters -->
          <div class="col-12 mt-3">
            <h6 class="text-muted small mb-2"><i class="fas fa-building me-1"></i>Organização</h6>
          </div>
          <div class="col-lg-2 col-md-4 col-sm-6">
            <label for="sector_id" class="form-label small fw-bold">Setor</label>
            <select id="sector_id" name="sector_id" class="form-select form-select-sm">
              <option value="">Todos setores</option>
              {% for sector in sectors %}
                <option value="{{ sector.id }}" {% if sector.id == selected_sector %}selected{% endif %}>{{ sector.name }}</option>
              {% endfor %}
            </select>
          </div>
          {% if session.is_admin %}
          <div class="col-lg-2 col-md-4 col-sm-6">
            <label for="user_id" class="form-label small fw-bold">Usuário</label>
            <select id="user_id" name="user_id" class="form-select form-select-sm">
              <option value="">Todos usuários</option>
              {% for user in users %}
                <option value="{{ user.id }}" {% if user.id == selected_user %}selected{% endif %}>{{ user.username }}</option>
              {% endfor %}
            </select>
          </div>
          {% endif %}
          <div class="col-12 mt-3">
            <hr class="my-3">
            <h6 class="mb-3">Exportar Relatórios</h6>
            <div class="row g-3">
              <div class="col-md-4">
                <label for="export_type" class="form-label small fw-bold">Tipo de Relatório</label>
                <select id="export_type" name="export_type" class="form-select form-select-sm">
                  <option value="all" {% if request.args.get('export_type', 'all') == 'all' %}selected{% endif %}>Todos os Dados</option>
                  <option value="tasks" {% if request.args.get('export_type') == 'tasks' %}selected{% endif %}>Apenas Tarefas</option>
                  <option value="reminders" {% if request.args.get('export_type') == 'reminders' %}selected{% endif %}>Apenas Lembretes</option>
                  <option value="chamados" {% if request.args.get('export_type') == 'chamados' %}selected{% endif %}>Apenas Chamados</option>
                  <option value="equipamentos">Apenas Equipamentos</option>
                  <option value="tutoriais" {% if request.args.get('export_type') == 'tutoriais' %}selected{% endif %}>Apenas Tutoriais</option>
                </select>
              </div>
              <div class="col-md-8">
                <label class="form-label small fw-bold">Formato de Exportação</label>
                <div class="d-flex gap-2 flex-wrap align-items-end">
                  <button type="submit" formaction="{{ url_for('main.export_excel') }}" class="btn btn-success btn-sm">
                    <i class="fas fa-file-excel me-1"></i> Exportar Excel
                  </button>
                  <button type="submit" formaction="{{ url_for('main.export_pdf') }}" class="btn btn-danger btn-sm">
                    <i class="fas fa-file-pdf me-1"></i> Exportar PDF
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 mt-3">
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary btn-sm">
                <i class="fas fa-search me-1"></i> Aplicar Filtros
              </button>
              <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary btn-sm">
                <i class="fas fa-times me-1"></i> Limpar Filtros
              </a>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Cards Principais de Serviços -->
  <div class="row g-3 mb-4">
    <!-- Tarefas -->
    <div class="col-xl-3 col-lg-4 col-md-6">
      <div class="card card-service h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h6 class="card-title mb-1">Tarefas</h6>
              <p class="text-muted small mb-0">Gerenciamento de atividades</p>
            </div>
            <div class="bg-primary bg-opacity-10 p-2 rounded">
              <i class="fas fa-tasks text-primary"></i>
            </div>
          </div>
          <h3 class="text-primary mb-3">{{ tasks_total }}</h3>
          <div class="service-stats">
            <div class="d-flex justify-content-between small mb-1">
              <span>Concluídas</span>
              <span class="text-success fw-bold">{{ tasks_done }}</span>
            </div>
            <div class="d-flex justify-content-between small mb-1">
              <span>Pendentes</span>
              <span class="text-warning fw-bold">{{ tasks_pending }}</span>
            </div>
            <div class="d-flex justify-content-between small">
              <span>Vencidas</span>
              <span class="text-danger fw-bold">{{ tasks_expired }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Lembretes -->
    <div class="col-xl-3 col-lg-4 col-md-6">
      <div class="card card-service h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h6 class="card-title mb-1">Lembretes</h6>
              <p class="text-muted small mb-0">Notificações e alertas</p>
            </div>
            <div class="bg-warning bg-opacity-10 p-2 rounded">
              <i class="fas fa-bell text-warning"></i>
            </div>
          </div>
          <h3 class="text-warning mb-3">{{ reminders_total }}</h3>
          <div class="service-stats">
            <div class="d-flex justify-content-between small mb-1">
              <span>Realizados</span>
              <span class="text-success fw-bold">{{ reminders_done }}</span>
            </div>
            <div class="d-flex justify-content-between small">
              <span>Pendentes</span>
              <span class="text-warning fw-bold">{{ reminders_pending }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chamados -->
    <div class="col-xl-3 col-lg-4 col-md-6">
      <div class="card card-service h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h6 class="card-title mb-1">Chamados</h6>
              <p class="text-muted small mb-0">Suporte e atendimento</p>
            </div>
            <div class="bg-info bg-opacity-10 p-2 rounded">
              <i class="fas fa-ticket-alt text-info"></i>
            </div>
          </div>
          <h3 class="text-info mb-3">{{ chamados_total }}</h3>
          <div class="service-stats">
            <div class="d-flex justify-content-between small mb-1">
              <span>Abertos</span>
              <span class="text-info fw-bold">{{ chamados_aberto }}</span>
            </div>
            <div class="d-flex justify-content-between small mb-1">
              <span>Andamento</span>
              <span class="text-warning fw-bold">{{ chamados_em_andamento }}</span>
            </div>
            <div class="d-flex justify-content-between small">
              <span>Fechados</span>
              <span class="text-success fw-bold">{{ chamados_fechado }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Equipamentos -->
    <div class="col-xl-3 col-lg-4 col-md-6">
      <div class="card card-service h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h6 class="card-title mb-1">Equipamentos</h6>
              <p class="text-muted small mb-0">Solicitações de Equipamentos</p>
            </div>
            <div class="bg-purple bg-opacity-10 p-2 rounded">
              <i class="fas fa-laptop text-purple"></i>
            </div>
          </div>
          <h3 class="text-purple mb-3">{{ equipamentos_total }}</h3>
          <div class="service-stats">
            <div class="d-flex justify-content-between small mb-1">
              <span>Solicitados</span>
              <span class="text-warning fw-bold">{{ equipamentos_solicitados }}</span>
            </div>
            <div class="d-flex justify-content-between small mb-1">
              <span>Entregues</span>
              <span class="text-success fw-bold">{{ equipamentos_entregues }}</span>
            </div>
            <div class="d-flex justify-content-between small">
              <span>Negados</span>
              <span class="text-danger fw-bold">{{ equipamentos_negados }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Inventário de Equipamentos -->
    <div class="col-xl-3 col-lg-4 col-md-6">
      <div class="card card-service h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h6 class="card-title mb-1">Inventário</h6>
              <p class="text-muted small mb-0">Equipamentos cadastrados</p>
            </div>
            <div class="bg-secondary bg-opacity-10 p-2 rounded">
              <i class="fas fa-boxes text-secondary"></i>
            </div>
          </div>
          <h3 class="text-secondary mb-3">{{ inventory_total }}</h3>
          <div class="service-stats">
            <div class="d-flex justify-content-between small mb-1">
              <span>Disponíveis</span>
              <span class="text-success fw-bold">{{ inventory_disponiveis }}</span>
            </div>
            <div class="d-flex justify-content-between small mb-1">
              <span>Emprestados</span>
              <span class="text-warning fw-bold">{{ inventory_emprestados }}</span>
            </div>
            <div class="d-flex justify-content-between small mb-1">
              <span>Manutenção</span>
              <span class="text-danger fw-bold">{{ inventory_manutencao }}</span>
            </div>
            <div class="d-flex justify-content-between small mb-1">
              <span>Danificados</span>
              <span class="text-danger fw-bold">{{ inventory_danificados }}</span>
            </div>
            <div class="d-flex justify-content-between small">
              <span>Perdidos</span>
              <span class="text-danger fw-bold">{{ inventory_perdidos }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tutoriais -->
    <div class="col-xl-3 col-lg-4 col-md-6">
      <div class="card card-service h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h6 class="card-title mb-1">Tutoriais</h6>
              <p class="text-muted small mb-0">Base de conhecimento</p>
            </div>
            <div class="bg-success bg-opacity-10 p-2 rounded">
              <i class="fas fa-book text-success"></i>
            </div>
          </div>
          <h3 class="text-success mb-3">{{ total_tutoriais }}</h3>
          <div class="service-stats">
            <div class="d-flex justify-content-between small mb-1">
              <span>Feedbacks Úteis</span>
              <span class="text-success fw-bold">{{ feedbacks_util }}</span>
            </div>
            <div class="d-flex justify-content-between small">
              <span>Feedbacks Negativos</span>
              <span class="text-danger fw-bold">{{ feedbacks_nao_util }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Geral -->
    <div class="col-xl-3 col-lg-4 col-md-6">
      <div class="card card-service h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h6 class="card-title mb-1">Performance</h6>
              <p class="text-muted small mb-0">Indicadores gerais</p>
            </div>
            <div class="bg-dark bg-opacity-10 p-2 rounded">
              <i class="fas fa-chart-line text-dark"></i>
            </div>
          </div>
          <h3 class="text-dark mb-3 performance-indicator">
            {{ overall_performance }}%
          </h3>
          <div class="service-stats">
            <div class="d-flex justify-content-between small mb-1">
              <span>Total Atividades</span>
              <span class="text-primary fw-bold">{{ tasks_total + reminders_total + chamados_total }}</span>
            </div>
            <div class="d-flex justify-content-between small">
              <span>Concluídas</span>
              <span class="text-success fw-bold">{{ tasks_done + reminders_done + chamados_fechado }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Ações Rápidas -->
    <div class="col-xl-3 col-lg-4 col-md-6">
      <div class="card card-service h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h6 class="card-title mb-1">Ações Rápidas</h6>
              <p class="text-muted small mb-0">Acesso direto</p>
            </div>
            <div class="bg-secondary bg-opacity-10 p-2 rounded">
              <i class="fas fa-bolt text-secondary"></i>
            </div>
          </div>
          <div class="d-grid gap-2">
            <a href="{{ url_for('main.tasks') }}" class="btn btn-outline-primary btn-sm">
              <i class="fas fa-plus me-2"></i>Nova Tarefa
            </a>
            <a href="{{ url_for('main.reminders') }}" class="btn btn-outline-warning btn-sm">
              <i class="fas fa-bell me-2"></i>Novo Lembrete
            </a>
            <a href="{{ url_for('main.abrir_chamado') }}" class="btn btn-outline-info btn-sm">
              <i class="fas fa-ticket-alt me-2"></i>Abrir Chamado
            </a>
            <a href="{{ url_for('equipment_v2.catalog') }}" class="btn btn-outline-success btn-sm">
              <i class="fas fa-laptop me-2"></i>Solicitar Equipamento
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gráficos -->
  <div class="row g-3 mb-4">
    <div class="col-lg-6">
      <div class="card">
        <div class="card-body">
          <h6 class="card-title mb-3">Evolução Mensal</h6>
          <div style="height: 300px;">
            <canvas id="chartEvolution"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="card">
        <div class="card-body">
          <h6 class="card-title mb-3">Distribuição por Setor</h6>
          <div style="height: 300px;">
            <canvas id="chartSector"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Seção SLA (Admin) -->
  {% if session.get('is_admin') %}
  <div class="row mb-4" id="sla-section">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-light">
          <div class="d-flex justify-content-between align-items-center">
            <h6 class="mb-0">
              <i class="fas fa-clock me-2"></i>Relatório de SLA
            </h6>
            <form method="get" action="{{ url_for('main.export_excel') }}" class="d-inline">
              <input type="hidden" name="export_type" value="chamados">
              <button type="submit" class="btn btn-success btn-sm">
                <i class="fas fa-file-excel me-1"></i>Exportar SLA
              </button>
            </form>
          </div>
        </div>
        <div class="card-body">
          <div class="row g-3 mb-4">
            <div class="col-md-3">
              <div class="text-center p-3 border border-danger rounded">
                <div class="text-danger h4 mb-1">{{ sla_vencidos or 0 }}</div>
                <small class="text-muted">SLA Vencidos</small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="text-center p-3 border border-warning rounded">
                <div class="text-warning h4 mb-1">{{ sla_criticos or 0 }}</div>
                <small class="text-muted">SLA Críticos</small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="text-center p-3 border border-success rounded">
                <div class="text-success h4 mb-1">{{ sla_ok or 0 }}</div>
                <small class="text-muted">SLA OK</small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="text-center p-3 border border-primary rounded">
                <div class="text-primary h4 mb-1">{{ performance_sla or 0 }}%</div>
                <small class="text-muted">Performance SLA</small>
              </div>
            </div>
          </div>

          <!-- Tabela SLA Simplificada -->
          <div class="mt-4">
            <h6 class="mb-3">Chamados por Status de SLA</h6>
            <div class="table-responsive">
              <table class="table table-sm table-striped">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Título</th>
                    <th>Prioridade</th>
                    <th>Status</th>
                    <th>Prazo SLA</th>
                    <th>Status SLA</th>
                  </tr>
                </thead>
                <tbody>
                  {% for chamado in chamados_sla %}
                  <tr>
                    <td>{{ chamado.id }}</td>
                    <td>
                      <div class="text-truncate" style="max-width: 200px;" title="{{ chamado.titulo }}">
                        {{ chamado.titulo }}
                      </div>
                    </td>
                    <td>
                      <span class="badge bg-{{ 'dark' if chamado.prioridade == 'Critica' else ('danger' if chamado.prioridade == 'Alta' else ('warning' if chamado.prioridade == 'Media' else 'info')) }}">
                        {{ chamado.prioridade }}
                      </span>
                    </td>
                    <td>
                      <span class="badge bg-{{ 'secondary' if chamado.status == 'Fechado' else ('success' if chamado.status == 'Resolvido' else ('warning' if chamado.status == 'Em Andamento' else 'primary')) }}">
                        {{ chamado.status }}
                      </span>
                    </td>
                    <td>
                      {% if chamado.prazo_sla %}
                        {{ chamado.prazo_sla | local_datetime }}
                      {% else %}
                        <span class="text-muted">N/A</span>
                      {% endif %}
                    </td>
                    <td>
                      {% if chamado.prazo_sla %}
                        {% set status_sla = chamado.status_sla %}
                        {% if status_sla == 'vencido' %}
                          <span class="badge bg-danger">Vencido</span>
                        {% elif status_sla == 'atencao' %}
                          <span class="badge bg-warning text-dark">Crítico</span>
                        {% elif status_sla == 'normal' %}
                          <span class="badge bg-success">OK</span>
                        {% endif %}
                      {% else %}
                        <span class="text-muted">N/A</span>
                      {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            
            <!-- Paginação SLA -->
            {% if sla_pagination and sla_pagination.pages > 1 %}
            <div class="mt-3 d-flex justify-content-between align-items-center">
              <div class="text-muted small">
                Exibindo {{ (sla_pagination.page - 1) * sla_pagination.per_page + 1 }} 
                a {{ [sla_pagination.page * sla_pagination.per_page, sla_pagination.total]|min }} 
                de {{ sla_pagination.total }} chamados
              </div>
              <nav aria-label="Navegação da tabela SLA">
                <ul class="pagination pagination-sm mb-0">
                  <!-- Botão Primeira Página -->
                  <li class="page-item {% if not sla_pagination.has_prev %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('main.dashboard', sla_page=1, **request.args) }}">
                      <i class="fas fa-angle-double-left"></i>
                    </a>
                  </li>
                  
                  <!-- Botão Anterior -->
                  <li class="page-item {% if not sla_pagination.has_prev %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('main.dashboard', sla_page=sla_pagination.prev_num, **request.args) if sla_pagination.has_prev else '#' }}">
                      <i class="fas fa-angle-left"></i>
                    </a>
                  </li>
                  
                  <!-- Números de Páginas -->
                  {% set start_page = [1, sla_pagination.page - 2]|max %}
                  {% set end_page = [sla_pagination.pages, sla_pagination.page + 2]|min %}
                  
                  {% if start_page > 1 %}
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                  {% endif %}
                  
                  {% for page_num in range(start_page, end_page + 1) %}
                    <li class="page-item {% if page_num == sla_pagination.page %}active{% endif %}">
                      <a class="page-link" href="{{ url_for('main.dashboard', sla_page=page_num, **request.args) }}">
                        {{ page_num }}
                      </a>
                    </li>
                  {% endfor %}
                  
                  {% if end_page < sla_pagination.pages %}
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                  {% endif %}
                  
                  <!-- Botão Próximo -->
                  <li class="page-item {% if not sla_pagination.has_next %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('main.dashboard', sla_page=sla_pagination.next_num, **request.args) if sla_pagination.has_next else '#' }}">
                      <i class="fas fa-angle-right"></i>
                    </a>
                  </li>
                  
                  <!-- Botão Última Página -->
                  <li class="page-item {% if not sla_pagination.has_next %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('main.dashboard', sla_page=sla_pagination.pages, **request.args) }}">
                      <i class="fas fa-angle-double-right"></i>
                    </a>
                  </li>
                </ul>
              </nav>
              
              <!-- Seletor de itens por página -->
              <div class="dropdown">
                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                  <i class="fas fa-list me-1"></i>{{ sla_pagination.per_page }} / página
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  {% for per_page in [5, 10, 20, 50] %}
                    <li>
                      <a class="dropdown-item {% if sla_pagination.per_page == per_page %}active{% endif %}" 
                         href="{{ url_for('main.dashboard', sla_per_page=per_page, sla_page=1, **request.args) }}">
                        {{ per_page }} por página
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

</div>

{% endblock %}

{% block scripts %}
<!-- Chart.js library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Dashboard charts -->
<script src="{{ url_for('static', filename='js/dashboard-charts.js') }}"></script>
{% endblock %}